# Итоговое описание проекта

## Что было создано

Полноценная система автоматической генерации и коррекции сайтов на основе Astro с использованием нейросетевой детекции объектов и LLM через OpenRouter API. Система поддерживает генерацию сайтов по описанию, автоматическую коррекцию наложений элементов и деплой готовых сайтов.

## Структура проекта

### Основные компоненты

1. **API Server (FastAPI)**
   - `app/main.py` - Главный файл приложения
   - `app/api/routes.py` - API маршруты
   - `app/models/schemas.py` - Модели данных (Pydantic)

2. **Сервисы**
   - `app/services/inference.py` - Детекция объектов через Detectron2
   - `app/services/chatgpt.py` - Интеграция с OpenRouter API для коррекции кода
   - `app/services/generation.py` - Генерация сайтов по описанию через LLM
   - `app/services/screenshot.py` - Создание скриншотов страниц через Playwright
   - `app/services/deploy.py` - Деплой и хранение готовых сайтов

3. **Утилиты**
   - `app/utils/html_parser.py` - Парсинг и обработка HTML

4. **Конфигурация**
   - `Dockerfile` - Docker образ
   - `docker-compose.yml` - Docker Compose конфигурация
   - `requirements.txt` - Python зависимости
   - `config/config.yaml` - Конфигурация модели Detectron2

5. **Документация**
   - `README.md` - Основная документация
   - `QUICKSTART.md` - Быстрый старт
   - `DEPLOYMENT.md` - Руководство по развертыванию
   - `API_EXAMPLES.md` - Примеры использования API
   - `GENERATION_API.md` - Документация API генерации сайтов
   - `SYSTEM_DESCRIPTION.md` - Полное описание системы
   - `SETUP_MODEL.md` - Инструкция по настройке модели
   - `OPENROUTER_SETUP.md` - Настройка OpenRouter API

## Как работает система

### Режим коррекции существующего кода (`/api/v1/correct`)

1. **Клиент отправляет JSON запрос** с Astro кодом страницы
2. **API сервер принимает запрос** и валидирует данные
3. **Генерируется скриншот** страницы через Playwright (или используется существующий)
4. **Detectron2 выполняет детекцию** объектов на скриншоте
5. **LLM через OpenRouter анализирует результаты** и исправляет код
6. **Возвращается исправленный** Astro код с обновленными координатами

### Режим генерации сайта по описанию (`/api/v1/generate`)

1. **Клиент отправляет описание** сайта
2. **Generation Service генерирует HTML код** страниц через LLM
3. **Для каждой страницы создается скриншот** через Playwright
4. **Итеративно выполняется детекция** и коррекция наложений
5. **Deploy Service сохраняет** готовый сайт
6. **Возвращается ссылка** на деплоенный сайт

## Ключевые особенности

- ✅ Полностью контейнеризовано через Docker
- ✅ REST API на FastAPI
- ✅ Генерация сайтов по текстовому описанию
- ✅ Интеграция с Detectron2 для детекции объектов
- ✅ Интеграция с OpenRouter API для доступа к различным LLM моделям
- ✅ Автоматическая коррекция наложений элементов
- ✅ Итеративная коррекция до устранения всех наложений
- ✅ Автоматическая конвертация координат (пиксели → vw/vh)
- ✅ Сохранение существующих блоков (опционально)
- ✅ Деплой готовых сайтов с доступом через URL
- ✅ Создание скриншотов через headless браузер (Playwright)
- ✅ Полная документация
- ✅ Готово к развертыванию на сервере

## Быстрый старт

```bash
# 1. Настройка переменных окружения
# Создайте файл .env со следующим содержимым:
# OPENROUTER_API_KEY=your_openrouter_api_key_here
# OPENROUTER_MODEL=openai/gpt-4-turbo-preview
# MODEL_PATH=/app/models/model_final.pth
# CONFIG_PATH=/app/config/config.yaml

# 2. Размещение модели
cp /path/to/model_final.pth models/

# 3. Запуск
docker-compose up -d --build

# 4. Проверка
curl http://localhost:8000/api/v1/health
```

## API Endpoints

- `POST /api/v1/generate` - Генерация сайта по описанию с автоматической коррекцией
- `POST /api/v1/correct` - Коррекция существующего Astro кода
- `GET /api/v1/health` - Проверка работоспособности
- `POST /api/v1/detect` - Только детекция объектов на изображении
- `GET /site/{site_hash}` - Доступ к главной странице деплоенного сайта
- `GET /site/{site_hash}/{page_id}` - Доступ к конкретной странице деплоенного сайта

## Требования

- Docker и Docker Compose
- OpenRouter API ключ (для доступа к LLM моделям)
- Обученная модель Detectron2 (model_final.pth)
- Конфигурация модели (config.yaml)

## Следующие шаги

1. Прочитайте `QUICKSTART.md` для быстрого старта
2. Настройте OpenRouter API согласно `OPENROUTER_SETUP.md`
3. Настройте модель согласно `SETUP_MODEL.md`
4. Изучите примеры в `API_EXAMPLES.md` и `GENERATION_API.md`
5. Разверните на сервере по `DEPLOYMENT.md`

## Поддержка

Все файлы документации содержат подробные инструкции и примеры. При возникновении проблем проверьте логи через `docker-compose logs api`.
